<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Map Quiz</title>

<link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600;9..144,800&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --claret:#670628;
  --pink:#FFBDC5;
  --choco:#48261D;
  --sky:#B2CDFF;
  --paper:#fff7f9;

  --dot:#0420f9;
  --good:#16a34a;
  --bad:#cc0000;
}

*{ box-sizing:border-box; }

html, body{
  margin:0;
  padding:0;
  overflow-x:hidden;
}

body{
  font-family: Inter, Arial, sans-serif;
  background: var(--paper);
  color: var(--choco);
}

/* Title bar scrolls away */
#pageTitleBar{
  background: var(--claret);
  border-bottom: 1px solid rgba(255,255,255,0.18);
  padding: 12px;
  text-align: center;
}

#topTitle{
  font-family: Fraunces, serif;
  font-weight: 800;
  letter-spacing: 0.5px;
  color: var(--pink);
  font-size: clamp(18px, 2vw, 26px);
}

/* ONLY Find follows when scrolling */
#findSticky{
  position: fixed;        /* ‚Üê this is the key */
  top: 70px;              /* distance from top (adjust if needed) */
  left: 50%;
  transform: translateX(-50%);

  z-index: 9999;

  background: transparent;
  padding: 10px 12px;
  display:flex;
  justify-content:center;
}

#findText{
  font-family: Fraunces, serif;
  font-weight: 800;
  letter-spacing: 0.3px;
  color: var(--choco);
  background: var(--pink);
  font-size: clamp(28px, 3vw, 46px);
  padding: 12px 26px;
  border-radius: 18px;
  border: 1px solid rgba(72,38,29,0.25);
  box-shadow: 0 10px 25px rgba(0,0,0,0.18);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: min(1100px, 95vw);
}

.container{
  width: 100%;
  padding: 14px 0 24px;
  margin: 0;
}

.map-card{
  width: 97vw;              /* 90% of screen */
  margin: 0 auto;           /* centers it */
  background: var(--pink);
  border-radius: 24px;
  border: 2px solid rgba(72,38,29,0.25);
  box-shadow: 10px 10px 0 rgba(0,0,0,0.16);
  overflow: hidden;
}

/* Header */
.map-header{
  padding: 12px 14px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
  border-bottom: 1px solid rgba(72,38,29,0.18);
  background: rgba(255,255,255,0.25);
}

#title{
  font-family: Fraunces, serif;
  font-weight: 800;
  font-size: 16px;
  margin-right: auto;
  color: var(--choco);
}

#status{
  font-weight: 800;
  color: rgba(72,38,29,0.85);
}

/* Buttons */
button{
  padding: 9px 14px;
  border-radius: 14px;
  border: 2px solid rgba(72,38,29,0.25);
  background: var(--sky);
  color: var(--choco);
  font-weight: 800;
  cursor:pointer;
}
button:hover{ filter: brightness(0.98); }
button:active{ transform: translateY(1px); }

button.danger{
  background: var(--claret);
  color: white;
}

#mapWrap{
  position: relative;

  width: 100vw;          /* change to 80vw for ~10% margins each side */
  max-width: 1600px;
  margin: 0 auto;

  aspect-ratio: 4 / 3;  /* IMPORTANT: controls height based on width */
  height: auto;         /* let aspect-ratio decide */

  background: rgba(255,255,255,0.22);
  overflow: hidden;
}

#map{
  width:100%;
  height:100%;
  object-fit: contain;  /* shows the whole map */
  display:block;
  background: rgba(255,255,255,0.15);
}

#canvas{
  position:absolute;
  left:0; top:0;
  width:100%;
  height:100%;
  cursor: crosshair;
  touch-action: none;
}

/* Editor under map */
.editor{
  padding: 12px 14px;
  border-top: 1px solid rgba(72,38,29,0.18);
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  background: rgba(255,255,255,0.20);
}

@media(max-width:900px){
  .editor{ grid-template-columns: 1fr; }
}

.row{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}

input, select{
  width: 100%;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid rgba(72,38,29,0.25);
  background: rgba(255,255,255,0.55);
  color: var(--choco);
}

select{ min-height: 220px; }
.smallhint{
  font-size: 12px;
  opacity: 0.85;
}
</style>
</head>

<body>

<div id="pageTitleBar">
  <div id="topTitle">Evropa mƒõsta</div>
</div>

<div id="findSticky">
  <div id="findText">Find: ‚Äî</div>
</div>

<div class="container">
  <div class="map-card">

    <div class="map-header">
      <div id="title">Map Quiz</div>

      <button onclick="setMode('setup')">Setup</button>
      <button onclick="setMode('quiz')">Quiz</button>
      <button class="danger" onclick="resetAll()">Reset</button>

      <span id="status">Mode: setup</span>
    </div>

    <div id="mapWrap">
      <img id="map" src="map.png" alt="Map">
      <canvas id="canvas"></canvas>
    </div>

    <div class="editor">
      <div>
        <div class="row" style="margin-bottom:10px;">
          <button id="btnRename" type="button">Rename</button>
          <button id="btnMove" type="button">Move</button>
          <button class="danger" id="btnDelete" type="button">Delete</button>
        </div>
        <div class="smallhint">
          Setup: click a dot to select. ‚ÄúMove‚Äù then click new spot.<br>
          Quiz: correct = green. 3 misses = red, then next.
        </div>
      </div>

      <div>
        <input id="searchBox" placeholder="Search..." />
        <div style="height:10px;"></div>
        <select id="pointList" size="10"></select>
      </div>
    </div>

  </div>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const img = document.getElementById('map');

const KEY = "mapquiz_points_norm_v3";

let points = JSON.parse(`[{"x":0.19773859350081582,"y":0.8137879086784197,"name":"Madrid"},{"x":0.08920849116721612,"y":0.8344482505066446,"name":"Lisabon"},{"x":0.112537391668831,"y":0.7759106153266737,"name":"Porto"},{"x":0.37371964728473683,"y":0.53085600530856,"name":"Rotterdam"},{"x":0.37473394730654613,"y":0.5216736311626823,"name":"Haag"},{"x":0.21903889395881201,"y":0.7420506106637493,"name":"Bilbao"},{"x":0.14296639232311129,"y":0.880934019620151,"name":"Sevilla"},{"x":0.2504821946349016,"y":0.847647913341344,"name":"Valencie"},{"x":0.3874126975791629,"y":0.5153607489373913,"name":"Amsterdam"},{"x":0.3701695972084041,"y":0.5589770261303108,"name":"Brusel"},{"x":0.39248419768820964,"y":0.591115335640883,"name":"Lucemburk"},{"x":0.16972547743055555,"y":0.9104166666666667,"name":"Mal√°ga"},{"x":0.30080661252248203,"y":0.8104166666666667,"name":"Barcelona"},{"x":0.2691409450564548,"y":0.70625,"name":"Bourdeaux"},{"x":0.36340153658323343,"y":0.7620833333333333,"name":"Marseilles"},{"x":0.22348347103567145,"y":0.5970833333333333,"name":"Brest"},{"x":0.3324722799885092,"y":0.6204166666666666,"name":"Pa≈ô√≠≈æ"},{"x":0.3479369082858713,"y":0.56375,"name":"Lille"},{"x":0.41495029757444046,"y":0.62625,"name":"≈†trasburk"},{"x":0.35382819525629494,"y":0.6970833333333334,"name":"Lyon"},{"x":0.2698773559277578,"y":0.6204166666666666,"name":"Rennes"},{"x":0.15205161651928456,"y":0.11208333333333333,"name":"Reykjavik"},{"x":0.1844536948566147,"y":0.485,"name":"Cork"},{"x":0.22716552539218623,"y":0.4583333333333333,"name":"Dublin"},{"x":0.2382116884617306,"y":0.43583333333333335,"name":"Newcastle"},{"x":0.23894809933303357,"y":0.42583333333333334,"name":"Belfast"},{"x":0.2698773559277578,"y":0.39916666666666667,"name":"Glasgow"},{"x":0.3022794342650879,"y":0.5258333333333334,"name":"Lond√Ωn"},{"x":0.26177683634342525,"y":0.5158333333333334,"name":"Cardiff"},{"x":0.28902403858163467,"y":0.49416666666666664,"name":"Birmingham"},{"x":0.27355941028427255,"y":0.47333333333333333,"name":"Liverpool"},{"x":0.2846055733538169,"y":0.4691666666666667,"name":"Manchester"},{"x":0.475335989021283,"y":0.31875,"name":"Oslo"},{"x":0.41495029757444046,"y":0.30541666666666667,"name":"Bergen"},{"x":0.5673873479341527,"y":0.33625,"name":"Stockholm"},{"x":0.560759650092426,"y":0.32375,"name":"Uppsala"},{"x":0.5040560130020983,"y":0.43875,"name":"Malmo"},{"x":0.4959554934177658,"y":0.43625,"name":"Koda≈à"},{"x":0.48785497383343324,"y":0.3720833333333333,"name":"Goteborg"},{"x":0.6542838307479016,"y":0.29791666666666666,"name":"Helsinky"},{"x":0.6167268763114508,"y":0.29875,"name":"Turku"},{"x":0.7154059330660472,"y":0.2970833333333333,"name":"Petrohrad"},{"x":0.6564930633618106,"y":0.32208333333333333,"name":"Tallin"},{"x":0.6461833111635692,"y":0.39375,"name":"Riga"},{"x":0.6712212807878697,"y":0.45458333333333334,"name":"Vilnius"},{"x":0.7198243982938649,"y":0.4675,"name":"Minsk"},{"x":0.6167268763114508,"y":0.5266666666666666,"name":"Var≈°ava"},{"x":0.5806427436176059,"y":0.4725,"name":"Gda≈àsk"},{"x":0.5600232392211231,"y":0.5591666666666667,"name":"Wroclaw"},{"x":0.6093627675984212,"y":0.585,"name":"Krakov"},{"x":0.6012622480140888,"y":0.5475,"name":"Lod≈æ"},{"x":0.5519227196367905,"y":0.525,"name":"Pozna≈à"},{"x":0.5025831912594924,"y":0.5241666666666667,"name":"Berl√≠n"},{"x":0.45839853898131494,"y":0.5025,"name":"Hamburk"},{"x":0.5114201217151279,"y":0.5625,"name":"Dr√°≈æƒèany"},{"x":0.4804908651204037,"y":0.64,"name":"Mnichov"},{"x":0.4385154454561351,"y":0.5816666666666667,"name":"Franfurt nad Mohanem"},{"x":0.47091752379346524,"y":0.5283333333333333,"name":"Wolfsburg"},{"x":0.48638215209082736,"y":0.5566666666666666,"name":"Lipsko"},{"x":0.4090590106040168,"y":0.5458333333333333,"name":"Dusseldorf"},{"x":0.41347747583183453,"y":0.5566666666666666,"name":"Kol√≠n na R√Ωnem"},{"x":0.35456460612759794,"y":0.5441666666666667,"name":"Bruggy"},{"x":0.3722384670388689,"y":0.5466666666666666,"name":"Antverpy"},{"x":0.388439506207534,"y":0.5658333333333333,"name":"Lutych"},{"x":0.40832259973271384,"y":0.6683333333333333,"name":"Bern"},{"x":0.4421974998126499,"y":0.6683333333333333,"name":"Vaduz"},{"x":0.4296785150004996,"y":0.6566666666666666,"name":"Curych"},{"x":0.38549386272232217,"y":0.6866666666666666,"name":"≈Ωeneva"},{"x":0.3928579714353517,"y":0.6783333333333333,"name":"Lausane"},{"x":0.40464054537619903,"y":0.7225,"name":"Tur√≠n"},{"x":0.42526004977268184,"y":0.7391666666666666,"name":"Janov"},{"x":0.4348333910996203,"y":0.7125,"name":"Mil√°n"},{"x":0.4458795541691647,"y":0.705,"name":"Bergamo"},{"x":0.48859138470473623,"y":0.7133333333333334,"name":"Ben√°tky"},{"x":0.4016949018909872,"y":0.7558333333333334,"name":"Monako/Nice"},{"x":0.4657626476943445,"y":0.7383333333333333,"name":"Bologna"},{"x":0.46208059333782975,"y":0.7608333333333334,"name":"Florencie"},{"x":0.4900642064473421,"y":0.7566666666666667,"name":"San Marino/Rimini"},{"x":0.48932779557603917,"y":0.8133333333333334,"name":"≈ò√≠m/Vatik√°n"},{"x":0.5180478195568545,"y":0.8408333333333333,"name":"Neapol"},{"x":0.5033196021307954,"y":0.915,"name":"Palermo"},{"x":0.47459957814998,"y":0.665,"name":"Innsbruck"},{"x":0.5018467803881894,"y":0.65,"name":"Salzburk"},{"x":0.5202570521707633,"y":0.6408333333333334,"name":"Linz"},{"x":0.5519227196367905,"y":0.6416666666666667,"name":"V√≠de≈à"},{"x":0.5681237588054556,"y":0.6408333333333334,"name":"Bratislava"},{"x":0.6285094502522982,"y":0.6241666666666666,"name":"Ko≈°ice"},{"x":0.6299822719949041,"y":0.6133333333333333,"name":"Pre≈°ov"},{"x":0.5997894262714828,"y":0.6191666666666666,"name":"Bansk√° Bystrica"},{"x":0.5924253175584533,"y":0.6116666666666667,"name":"≈Ωilina"},{"x":0.5821155653602118,"y":0.6266666666666667,"name":"Nitra"},{"x":0.6005258371427857,"y":0.6583333333333333,"name":"Budape≈°≈•"},{"x":0.5246755173985811,"y":0.6966666666666667,"name":"Lubla≈à"},{"x":0.5497134870228817,"y":0.7041666666666667,"name":"Z√°h≈ôeb"},{"x":0.5909524958158473,"y":0.7541666666666667,"name":"Sarajevo"},{"x":0.5651781153202438,"y":0.7333333333333333,"name":"Banja Luka"},{"x":0.5578140066072143,"y":0.7666666666666667,"name":"Split"},{"x":0.578433511003697,"y":0.7816666666666666,"name":"Dubrovnik"},{"x":0.597580193657574,"y":0.6958333333333333,"name":"Szged"},{"x":0.5857976197167266,"y":0.6966666666666667,"name":"P√©cs"},{"x":0.6402920241931455,"y":0.6516666666666666,"name":"Debrecen"},{"x":0.6078899458558154,"y":0.79,"name":"Podgorica"},{"x":0.6299822719949041,"y":0.7375,"name":"Bƒõlohrad"},{"x":0.6432376676783573,"y":0.7858333333333334,"name":"Pri≈°tina"},{"x":0.6211453415392686,"y":0.8266666666666667,"name":"Tirana"},{"x":0.6520745981339928,"y":0.8041666666666667,"name":"Skopje"},{"x":0.6181996980540567,"y":0.7208333333333333,"name":"Novi Sad"},{"x":0.7028869482538969,"y":0.9075,"name":"Ath√©ny"},{"x":0.6785853895008993,"y":0.8383333333333334,"name":"Solu≈à"},{"x":0.6852130873426259,"y":0.7775,"name":"Sofie"},{"x":0.7117238787095324,"y":0.7875,"name":"Plovdiv"},{"x":0.7617998179581335,"y":0.7516666666666667,"name":"Varna"},{"x":0.753699298373801,"y":0.7783333333333333,"name":"Burgas"},{"x":0.7316069722347123,"y":0.7125,"name":"Bukur≈°≈•"},{"x":0.6704848699165668,"y":0.6633333333333333,"name":"Klu≈æ"},{"x":0.7566449418590128,"y":0.645,"name":"Ki≈°inƒõv"},{"x":0.7743188027702838,"y":0.5491666666666667,"name":"Kyjev"},{"x":0.8766799138813949,"y":0.5416666666666666,"name":"Charkov"},{"x":0.7919926636815547,"y":0.6525,"name":"Odesa "},{"x":0.8501691225144884,"y":0.6925,"name":"Sevastopol"},{"x":0.6844766764713229,"y":0.58,"name":"Lvov"},{"x":0.910554813961331,"y":0.5608333333333333,"name":"Luhansk"},{"x":0.8781527356240008,"y":0.5933333333333334,"name":"Donƒõck"},{"x":0.961367164081235,"y":0.685,"name":"Soƒçi"},{"x":0.926019442258693,"y":0.5883333333333334,"name":"Rostov na Donu"},{"x":0.9878779554481415,"y":0.5491666666666667,"name":"Volgograd"},{"x":0.8516419442570944,"y":0.40291666666666665,"name":"Moskva"},{"x":0.9495845901403877,"y":0.38375,"name":"Ni≈ænij Novgorod"},{"x":0.5497134870228817,"y":0.08958333333333333,"name":"Narvik"},{"x":0.5070016564873101,"y":0.7058333333333333,"name":"Terst"}]`);let mode = "setup";
localStorage.setItem(KEY, JSON.stringify(points));

let selectedIndex = -1;
let moveArmed = false;

let currentQuiz = null;
let solved = new Set();
let failed = new Set();
let attempts = 0;

const DOT_MM = 3;
const HIT_RADIUS = 8;  // setup selection tolerance (px)
const QUIZ_RADIUS = 10; // smaller quiz hit area

function setTarget(t){ document.getElementById("findText").innerText = t; }
function setStatus(t){ document.getElementById("status").innerText = t; }

function save(){
  localStorage.setItem(KEY, JSON.stringify(points));
  renderList();
}

function mmToPx(mm){ return mm * (96/25.4); }

function resizeCanvas(){
  const r = document.getElementById("mapWrap").getBoundingClientRect();
  canvas.width = Math.round(r.width);
  canvas.height = Math.round(r.height);
  drawPoints();
}

function getRect(){
  const wrap = document.getElementById("mapWrap").getBoundingClientRect();
  const iw = img.naturalWidth;
  const ih = img.naturalHeight;
  const cw = wrap.width;
  const ch = wrap.height;

  if (!iw || !ih || !cw || !ch) return {x:0,y:0,w:cw,h:ch};

  const ir = iw/ih;
  const br = cw/ch;

  let w,h,x,y;
  if(ir > br){
    w = cw;
    h = cw/ir;
    x = 0;
    y = (ch - h)/2;
  } else {
    h = ch;
    w = ch*ir;
    y = 0;
    x = (cw - w)/2;
  }
  return {x,y,w,h};
}

function normToPx(p){
  const r = getRect();
  return { x: r.x + p.x * r.w, y: r.y + p.y * r.h };
}

function pxToNorm(x,y){
  const r = getRect();
  const cx = Math.min(Math.max(x, r.x), r.x + r.w);
  const cy = Math.min(Math.max(y, r.y), r.y + r.h);
  return { x: (cx - r.x) / r.w, y: (cy - r.y) / r.h };
}

function drawPoints(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const radius = mmToPx(DOT_MM)/2;

  for(let i=0;i<points.length;i++){
    const p = normToPx(points[i]);

    ctx.beginPath();
    ctx.arc(p.x,p.y,radius,0,Math.PI*2);

    if(mode==="quiz" && solved.has(i)) ctx.fillStyle = "#16a34a";
    else if(mode==="quiz" && failed.has(i)) ctx.fillStyle = "#cc0000";
    else ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--dot').trim() || "#0420f9";

    ctx.fill();

    if(mode==="setup" && i===selectedIndex){
      ctx.lineWidth = 2;
      ctx.strokeStyle = "rgba(72,38,29,0.65)";
      ctx.stroke();
    }
  }
}

function setMode(m){
  mode=m;
  selectedIndex = -1;
  moveArmed = false;

  if(mode==="quiz"){
    solved = new Set();
    failed = new Set();
    attempts = 0;
    startQuiz();
    setStatus("Mode: quiz");
  } else {
    currentQuiz = null;
    setTarget("Find: ‚Äî");
    setStatus("Mode: setup");
  }

  drawPoints();
  renderList();
}

function startQuiz(){
  attempts = 0;

  if(points.length===0){
    currentQuiz = null;
    setTarget("Find: ‚Äî");
    return;
  }

  const remaining = [];
  for(let i=0;i<points.length;i++){
    if(!solved.has(i) && !failed.has(i)) remaining.push(i);
  }

  if(remaining.length===0){
    currentQuiz = null;
    setTarget("Finished üéâ");
    return;
  }

  const idx = remaining[Math.floor(Math.random()*remaining.length)];
  currentQuiz = { index: idx };
  setTarget("Find: " + (points[idx].name || "‚Äî"));
}

canvas.addEventListener("click", (e)=>{
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  if(mode==="setup"){
    const r = getRect();
    const inside =
      x >= r.x && x <= r.x + r.w &&
      y >= r.y && y <= r.y + r.h;

    if(moveArmed && selectedIndex >= 0){
      const n = pxToNorm(x,y);
      points[selectedIndex].x = n.x;
      points[selectedIndex].y = n.y;
      moveArmed = false;
      save();
      drawPoints();
      return;
    }

    let found = -1;
    for(let i=0;i<points.length;i++){
      const p = normToPx(points[i]);
      if(Math.hypot(p.x-x,p.y-y) < HIT_RADIUS){
        found = i;
        break;
      }
    }
    if(found >= 0){
      selectedIndex = found;
      drawPoints();
      return;
    }

    if(!inside){
      alert("Click on the actual map (not the empty margin).");
      return;
    }

    const name = prompt("City name:");
    if(!name) return;

    const n = pxToNorm(x,y);
    points.push({ x:n.x, y:n.y, name });
    selectedIndex = points.length - 1;
    save();
    drawPoints();
    return;
  }

  if(mode==="quiz"){
    if(!currentQuiz) return;

    const target = normToPx(points[currentQuiz.index]);
    const dist = Math.hypot(target.x-x, target.y-y);

    if(dist < QUIZ_RADIUS){
      solved.add(currentQuiz.index);
      attempts = 0;
      drawPoints();
      startQuiz();
    } else {
      attempts++;
      if(attempts >= 3){
        failed.add(currentQuiz.index);
        attempts = 0;
        drawPoints();
        startQuiz();
      }
    }
  }
});

function renderList(){
  const list = document.getElementById("pointList");
  const q = (document.getElementById("searchBox").value || "").toLowerCase();

  list.innerHTML = "";
  for(let i=0;i<points.length;i++){
    const nm = points[i].name || "";
    if(q && !nm.toLowerCase().includes(q)) continue;

    const opt = document.createElement("option");
    opt.value = String(i);
    opt.textContent = `${i+1}. ${nm}`;
    if(i === selectedIndex) opt.selected = true;
    list.appendChild(opt);
  }
}

document.getElementById("searchBox").addEventListener("input", renderList);
document.getElementById("pointList").addEventListener("change", (e)=>{
  const idx = parseInt(e.target.value, 10);
  if(Number.isNaN(idx)) return;
  selectedIndex = idx;
  moveArmed = false;
  drawPoints();
});

document.getElementById("btnRename").onclick = ()=>{
  if(mode !== "setup") return alert("Switch to Setup.");
  if(selectedIndex < 0) return alert("Select a point first.");
  const cur = points[selectedIndex].name || "";
  const n = prompt("New name:", cur);
  if(!n) return;
  points[selectedIndex].name = n;
  save();
  drawPoints();
};

document.getElementById("btnMove").onclick = ()=>{
  if(mode !== "setup") return alert("Switch to Setup.");
  if(selectedIndex < 0) return alert("Select a point first.");
  moveArmed = true;
};

document.getElementById("btnDelete").onclick = ()=>{
  if(mode !== "setup") return alert("Switch to Setup.");
  if(selectedIndex < 0) return alert("Select a point first.");
  if(!confirm(`Delete "${points[selectedIndex].name || ""}"?`)) return;
  points.splice(selectedIndex, 1);
  selectedIndex = -1;
  moveArmed = false;
  save();
  drawPoints();
};

function resetAll(){
  if(!confirm("Delete all points?")) return;
  localStorage.removeItem(KEY);
  points = [];
  solved = new Set();
  failed = new Set();
  attempts = 0;
  selectedIndex = -1;
  moveArmed = false;
  currentQuiz = null;
  setTarget("Find: ‚Äî");
  drawPoints();
  renderList();
}

function init(){
  resizeCanvas();
  renderList();
  drawPoints();
  setStatus("Mode: " + mode);
}

img.addEventListener("load", init);
window.addEventListener("resize", resizeCanvas);
if (img.complete) init();

setMode("setup");
</script>
</body>
</html>
